# FriendsLeague - Cursor Rules

## ğŸ¯ Prosjektoversikt
FriendLeague er en sosial applikasjon som kombinerer meldingsfunksjonalitet med konkurransefunksjoner. Brukere kan kommunisere Ã©n-til-Ã©n eller i grupper, opprette "ligaer" med regler, poengsystem og leaderboard, samt arrangere events.

## ğŸ› ï¸ Teknologistack (IKKE ENDRE)

### Frontend
- **React Native** - Cross-platform mobilapp
- **TypeScript** - Type-sikkerhet
- **Zustand** - State management
- **React Navigation** - Navigasjon
- **Socket.io Client** - Sanntidskommunikasjon

### Backend
- **NestJS** - Node.js framework (IKKE Express.js eller Fastify)
- **TypeScript** - Type-sikkerhet
- **Prisma** - ORM for database (IKKE TypeORM eller andre ORM-er)
- **PostgreSQL** - Hoveddatabase (IKKE MongoDB eller andre databaser)
- **Redis** - Caching og sanntidsdata
- **Socket.io** - WebSocket for sanntidskommunikasjon
- **JWT** - Autentisering

### Infrastruktur
- **Docker** - Containerisering
- **AWS S3** - Filopplasting
- **Firebase** - Push notifications

### Hosting
- Databasen er hosted pÃ¥ Neon
- Backend er hosted pÃ¥ Render
- Redis er hosted pÃ¥ Upstash

## ğŸ“ Prosjektstruktur
```
(kan endres)
friendsleague/
â”œâ”€â”€ backend/          # NestJS API
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ auth/     # Autentisering
â”‚   â”‚   â”œâ”€â”€ chat/     # Chat-funksjonalitet
â”‚   â”‚   â”œâ”€â”€ leagues/  # Liga-funksjonalitet
â”‚   â”‚   â”œâ”€â”€ events/   # Event-funksjonalitet
â”‚   â”‚   â”œâ”€â”€ users/    # BrukerhÃ¥ndtering
â”‚   â”‚   â””â”€â”€ common/   # Delte moduler
â”‚   â”œâ”€â”€ prisma/       # Database schema
â”‚   â””â”€â”€ docker-compose.yml
â”œâ”€â”€ mobile/           # React Native app
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ screens/  # App-skjermer
â”‚   â”‚   â”œâ”€â”€ components/ # Gjenbrukbare komponenter
â”‚   â”‚   â”œâ”€â”€ store/    # Zustand state management
â”‚   â”‚   â”œâ”€â”€ services/ # API-tjenester
â”‚   â”‚   â””â”€â”€ types/    # TypeScript typer
â”œâ”€â”€ shared/           # Delte typer og interfaces
â””â”€â”€ docs/             # Dokumentasjon
```

## ğŸ¨ Kodekonvensjoner

### TypeScript
- Bruk **strict mode** alltid
- Definer typer eksplisitt, ikke `any`
- Bruk interfaces for objekter, types for unions
- Eksporter typer med `export type` nÃ¥r mulig

### NestJS
- FÃ¸lg NestJS modulstruktur (Controller, Service, Module)
- Bruk **decorators** for validering og autentisering
- Implementer **DTOs** for alle API-endepunkter
- Bruk **Guards** for autentisering og autorisering
- Implementer **Interceptors** for logging og feilhÃ¥ndtering

### Prisma
- Definer **schema** i `schema.prisma`
- Bruk **Prisma Client** for database-operasjoner
- Implementer **migrations** for database-endringer
- Bruk **transactions** for komplekse operasjoner

### React Native
- Bruk **functional components** med hooks
- Implementer **custom hooks** for gjenbrukbar logikk
- Bruk **Zustand** for global state management
- FÃ¸lg **React Navigation** best practices

## ğŸ—ï¸ Clean Code & Modularization Principles

### ğŸ“ File Size & Complexity Limits
- **Screens**: Maksimalt 300-400 linjer per fil
- **Components**: Maksimalt 200-250 linjer per fil
- **Services**: Maksimalt 300 linjer per fil
- **Hooks**: Maksimalt 100 linjer per fil
- **Hvis filen blir for stor**: Del opp i mindre, fokuserte moduler

### ğŸ”§ Modularization Strategy
- **ALDTID** tenk fÃ¸rst: "Kan dette deles opp i mindre deler?"
- **Identifiser gjenbrukbar logikk** og ekstraher til custom hooks
- **Separer UI-komponenter** fra business logic
- **Opprett spesialiserte komponenter** for spesifikke funksjoner
- **Bruk composition** over inheritance

### ğŸ¯ Component Design Principles
- **Single Responsibility**: Hver komponent har Ã©n klar oppgave
- **Props Interface**: Definer tydelige, type-sikre props
- **Default Props**: Bruk default verdier for valgfrie props
- **Error Boundaries**: Implementer feilhÃ¥ndtering pÃ¥ komponentnivÃ¥
- **Memoization**: Bruk `React.memo` for performance-optimering

### ğŸª Custom Hooks Guidelines
- **Ekstraher gjenbrukbar logikk** til custom hooks
- **Prefix med "use"** (f.eks. `useVideoThumbnail`, `useSwipeToClose`)
- **Returner objekt** med navngitte properties
- **HÃ¥ndter loading og error states** i hooks
- **Dokumenter hook dependencies** og side effects

### ğŸ“± Screen Architecture
- **Container/Presentational Pattern**: Separer data-logikk fra UI
- **Custom hooks** for kompleks state management
- **Modular components** for UI-deler
- **Service layer** for API-kall og business logic
- **Error handling** pÃ¥ hvert nivÃ¥

### ğŸ§© Component Composition
- **Compound Components**: For relaterte UI-elementer
- **Render Props**: For fleksibel data-deling
- **Higher-Order Components**: For cross-cutting concerns
- **Context API**: For deep prop drilling

### ğŸ“‹ Planning & Design Process
1. **Analyser kravet** - Hva skal implementeres?
2. **Identifiser komponenter** - Hvilke UI-deler trengs?
3. **Identifiser hooks** - Hvilken logikk kan gjenbrukes?
4. **Design interfaces** - Hvordan skal komponenter kommunisere?
5. **Planer filstruktur** - Hvor skal hver del plasseres?
6. **Implementer inkrementelt** - Bygg opp steg for steg
7. **Refaktorer** - Forbedre og forenkle etter implementasjon

### ğŸ”„ Refactoring Guidelines
- **Regelmessig refaktorering** - Ikke la kode bli rotete
- **Identifiser code smells**: Lange funksjoner, duplisert kode, komplekse conditions
- **Ekstraher konstanter** og magic numbers
- **Forenkle nested conditions** med early returns
- **Bruk descriptive names** for variabler og funksjoner

### ğŸ“¦ File Organization
```
components/
â”œâ”€â”€ ui/              # Grunnleggende UI-komponenter
â”œâ”€â”€ forms/           # Form-relaterte komponenter
â”œâ”€â”€ media/           # Media-spesifikke komponenter
â””â”€â”€ layout/          # Layout-komponenter

hooks/
â”œâ”€â”€ api/             # API-relaterte hooks
â”œâ”€â”€ ui/              # UI-interaksjon hooks
â””â”€â”€ data/            # Data management hooks

services/
â”œâ”€â”€ api/             # API services
â”œâ”€â”€ storage/         # Local storage services
â””â”€â”€ utils/           # Utility functions
```

### âš¡ Performance Considerations
- **Lazy loading** for store komponenter
- **Code splitting** pÃ¥ screen-nivÃ¥
- **Memoization** for dyre beregninger
- **Debouncing** for user input
- **Virtualization** for store lister

### ğŸ§ª Testing Strategy
- **Unit tests** for custom hooks og utility functions
- **Component tests** for UI-komponenter
- **Integration tests** for komplekse funksjoner
- **Mock external dependencies** konsekvent

## ğŸ”’ Sikkerhet
- Valider all input med **class-validator**
- Bruk **JWT access tokens** (kort levetid) + **refresh tokens** (lang levetid)
- Implementer **refresh token rotation** for bedre sikkerhet pÃ¥ mobile enheter
- Implementer **rate limiting** pÃ¥ API-endepunkter
- Sanitizer brukerinput fÃ¸r lagring
- Bruk **HTTPS** i produksjon
- **Token blacklisting** ved utlogging

## ğŸ“Š Database Design
- **PostgreSQL** som hoveddatabase
- **Redis** for caching og sanntidsdata
- **Normalisering** - fÃ¸lg 3NF for dataintegritet
- **Indeksering** - lag indekser pÃ¥ alle foreign keys og ofte brukte kolonner
- **Soft delete** for viktige data (ikke hard delete)
- **Prisma migrations** - alltid kjÃ¸re via CI/CD fÃ¸r produksjon for Ã¥ unngÃ¥ inkonsistens

## ğŸš€ Performance
- Implementer **caching** med Redis
- Bruk **pagination** for store datamengder
- Optimiser **database queries** med Prisma
- Implementer **lazy loading** i React Native
- Komprimer bilder fÃ¸r opplasting

## ğŸ§ª Testing
- **Unit tests** for alle services
- **Integration tests** for API-endepunkter
- **E2E tests** for kritiske brukerflyter
- Bruk **Jest** for testing
- **Database migrations** - test i CI/CD fÃ¸r produksjon

## ğŸ“ Dokumentasjon
- Dokumenter alle API-endepunkter
- Skriv **README** for hver modul
- Bruk **JSDoc** for funksjoner
- Oppdater **CHANGELOG** for endringer

## ğŸš« IKKE BRUK
- Express.js eller Fastify (bruk NestJS)
- TypeORM eller andre ORM-er (bruk Prisma)
- MongoDB eller andre databaser (bruk PostgreSQL)
- Redux (bruk Zustand)
- JavaScript (bruk TypeScript)

## âœ… ALLTID BRUK
- TypeScript for type-sikkerhet
- Prisma for database-operasjoner
- NestJS decorators og moduler
- Zustand for state management
- JWT access + refresh tokens for autentisering
- Docker for containerisering
- Database indekser pÃ¥ foreign keys
- Prisma migrations via CI/CD

## ğŸš« IKKE GÃ… VIDERE UTEN TILLATELSE
- **ALDRIG** implementere nye funksjoner uten eksplisitt tillatelse
- **ALDRIG** opprette nye filer uten at brukeren ber om det
- **ALDRIG** gÃ¥ videre til neste steg uten at brukeren sier "okay" eller "gÃ¥ videre"
- **ALDRIG** gjÃ¸re flere endringer samtidig uten Ã¥ spÃ¸rre fÃ¸rst
- **ALDRIG** anta at brukeren vil ha noe implementert
- **ALLTID** spÃ¸rre fÃ¸r du gjÃ¸r noe nytt: "Vil du at jeg skal..."
- **ALLTID** vente pÃ¥ bekreftelse fÃ¸r du fortsetter
- **ALLTID** gi brukeren full oversikt over hva som er gjort
